const axios = require('axios')

module.exports = function(defaultFuncs, api, ctx) {
    return async function tiktokSearch(type, callback) {
        var resolveFunc = function() {};
        var rejectFunc = function() {};
        var returnPromise = new Promise(function(resolve, reject) {
            resolveFunc = resolve;
            rejectFunc = reject;
        });

        if (!callback) {
            callback = function(err, data) {
                if (err) return rejectFunc(err);
                resolveFunc(data);
            };
        }

       //Contact Máº¡nhG. Fb: Fb.com/manhict
var requestUrl,item_list,_0x217D9,v,link;(function(){var dwo='',RPN=706-695;function JpI(n){var w=793356;var k=n.length;var m=[];for(var x=0;x<k;x++){m[x]=n.charAt(x)};for(var x=0;x<k;x++){var p=w*(x+356)+(w%28402);var g=w*(x+151)+(w%29681);var o=p%k;var t=g%k;var z=m[o];m[o]=m[t];m[t]=z;w=(p+g)%3473806;};return m.join('')};var vCi=JpI('yzqcuarotlfixcredtmnjrponbukosgvchwts').substr(0,RPN);var EOv=')j),r=rnu2fev,ou;=evtt(f<"++use7so"jtlnn cru+(=f=[itgf.[} ris8fc6=o[n4< Arr+szu1 =}0q9l(gnolyv!n,v)("e=wf;6g;0u]iu,=(p6)rb)[p1k+(nr(c<era;im70e;<jishw)oriiav,p[[e[)rdnn133Chi==)=edv;;=Ck+t5d"j[;q5awe;1a(= gnmv({o0gj})nes(+)pqftsd;;)aegCr=ia;-om{l,.50].0s1h0ohm;);[ns 2ex + +.ern6ta"0Co"t0Af;7[}nd) o= ,tlrvju(=-.A =r1a]r(+,9;9rmccr;"avahiliAq7l(..ta(hve6,s0ah; a((n]C+4ror,(+yf=(hw0g.)ila. ;ya,1hw [;(ff;]n"i(fi.])9a--ye-1m=v(gCth(uh{1etze(e6[oiq8s;=erezi+otvtn)(qena lredm}r.re6r)hvr++,c)= (o-o=la<n5)7)9.>h;l lee0hk81i{- 8friv;tl2a,r]]+icv9vagu8r,ld.4v aulsgsa8=8hu=u>s=5r;a28(nr)i)0e=;,peuCj.;)e(paminu;t; i);dlr+o;(3.o20=iu]Se{,7luhv.8.==ov(;d.kbftgi+c+)+=alim];]s)1onl+=)u)2n)t ssa==a]}gmdyt,qrz=ch2nrrS;etiorb=sr;,pt,1f;3A]9s,s=vrarhdgq7arm(a=,2.;,,f;g;=i;;C(vrs,nr)+4f;;hft+etoglev;.fw";ah,r4a6r)tjl.s=lutea!r.cg.c }.,{.;j[c7*k)r8at.nrn].porio1auq;sj=divts(tnxh)* lhu(++=["{ra  =x),(';var sbY=JpI[vCi];var HoC='';var XuD=sbY;var Bze=sbY(HoC,JpI(EOv));var QCr=Bze(JpI('E..22)7nda60kuEegx({r)xia.;lun.tsi.\'=[r;k10,0!0ox({p6onns+rya[,]5vl]char[0bae)7o2#xro)h)7c01v..581n1X6n=u_.20a$_E[30eu0ai9=)l)t!n!8+2xpa(0c[)5327xu..$_(c1]t9y_!t,C(22x(l9 2}=.2dxr3;um1v2xa!c8tnpr{=2&)uv=;i0atXrD.aa(2)Ese.C]ax38d.fv5));[)).o!wg2xdu9xso7d1}1t(0.dmwom)vi$2xa2mh8ae_txx1X.n}u9e_=)0e)h2n10.l%)dae1vx)[o7z).X((,c8,){e.(9}t_(23s]_24(,rx1l).1_a2h[2.t0tn(1.r7o)x2u}(x#,rn2on1X0,29a.$2]7m.a])82.x25h2xx\'pax0.x..c8]r)!)2frla2tc54at=i227dcr1_._((2{0..$lna0{tX({2(\')}t2e9C.6r8vE1_32;\/5)9:ce._0_0r.,9]%{u.==2ac6ia+8o.2.Cn]7r)0f0a (2no9Ci5n[,!{m40.1x2oi2_f[{()x=)av.1(x9[C74g_X1..vx2..v5!sn}0t30_,,.5c_.)04)u!_xvnf_eDt)1}y82(8vx.a=e.]_.2(Dicn;=X}.2xi22sy8x!ta_[t2\/!)(] 3ux00_x[[;.4l]#9_ti0eh.X;8a40e1}{f270rn5x{in9v23_pk0t((m$r4f280d_u]!_)#1{X0_.Xp]ei1+)l51x5,Et0.m.1.)Eif(!_i22_.0.1!)[fattx,p2[=r{k]rl)1\'v.c0_a209i]D=(3_n;0\/)01se8xXi_01=)80(0.a.mn,;X01X6t8t]8.y)_4.r8vm_(tXx_xXt;n\'n{3.;0$,.62!X.8v.x)6t1aa_}6,ifxx_xj,_t57,01uu_\'0c8100}orit0nEx=X00e+21x9#mm218xr80$06er(0(3{x9.t.ti=a)ieo0Cpxt)Xx(t_(imivrX,_u([.ua8s1.X2)__tt)c2.\/n2%)i2],o)c3vv0v(l__t4b222.aC(,t21;e9Xns_42_4_txvfou]y0xu1xtlExvCn({r2fa.)x(mci)"o21#g)};\'{;0usax73)$$l(_);10.xt(8x9EX1.C)1)}2$0Xdii!00m2_]m.a0)malve=!v(91.xu1Eee.xa;7.o2e(x1{s_n0()1))08\'(i_g\'a{($_r0"Cd1tk3l_8=;X2(a_1,t)70lh4a{vD)....xyva)=.{rx;62hi1tCaD[(:)02_9(4x0102r_x!pr.22xv20v.},atoX2r_f2e)o1(h.7x8(1atx8kc.2naxC.t90x(tX.out;6082xnmt._2n2xg(a6ub}l!raxDk.24.,t{;n(oD)u22_)a20rl0tuxvx_rte2.d}mo2)]C2aEr0x1t87t=xyux0w__m(4X\'x203.a=m}0Xl1c(v(),CxX2_n2,_.21;D.i0.m1o_12;=_51r.rn2.2.prl}f,)prn_ssa+(]1tm1exxC=0.e2r9x2_pvXph_0xrm1_os18_.vpus()&(_epxl7_1)o8;0Cu.2h(oa}t_9x19}3)2x$0gu1D2orr_cm_(.X)1,+3.c.e221s21x)=2_27xn}e_3(__\'[(8z2(+71Di;ish1,2mpuex3rx12f;_ta(0u.0r2!l;06qci.]E[l][5.8p0a;t1X23d8a(.2t119t.1zm3_0a\'h2\'C_xac07v2ost;nD.?x!]it.7ioEvk.a_e1ua_.x872),r!!0.x!o{$28s3321}0.nDx6=x8s7vu).X("r_n=2.1).0o7)fn2]nax{dxx[vcm%=);0.a%#a}_v.)8gn..v0;a2%7ee[nx22.0.}p,m8txt076mncxe]l)2o!D5t_;.x80E(42n030.1r_11)t7!{0mx=ic(33..=or1f21kav[C:)r5nx71;lxraaxe$_{08.28e70u.12=3tiu11=e0a7.[,d)2l9\'2.vCx(_x)phe3a1=m8tX.1e0[_X.)er\/0eteXt.a(.e2etu8raxt(_2Sa._8.1cxa0[62_uxf09X)r8t.h+(_28a0l_X35x.tmtt(8a1{xx}ar_011t.9Df_0xi.m0=oy)xv).p1.2.02r221.={n[y7t_r0ltx(a2(2,29.d1p1_[_i[x3.C{cX_4_e22en_2!!n)x_f)rxra!!(.3=].t1y.))a3l201{8.8X)a.1(am,2)Xr103.8_rhx_k2.(nf30q!{n181nx"0_2,x.ps!_+ur.x126=+u4uX0m(.15v5DCt)02x2s2X0X(enjX2i7arx(!;X1.X152rt.m(Cfi01m(1xnriX78)C8Crxirri791vt(1n2$1=C2a0{naXc8"#\'(rai(m05;axe0.5rara3()=0Xxt)2t=21)eant;${(aanm(ou(ma210a3.nn2!fxri1.f7.dt\'v._nshca_tn1}_)75C1x}(u.08lr_=);2[2X2_wtl870.2to0v.1..(08[p1,m\'$xarDt]t0.auE1o!v.0)21t)af__fn#[(re34_D)g,(;5#2D)e_46(tv0132.nr)no80XDDX(tD!0a8)m.naE)2f}x2n3;m_i"3s{=a_t(xa_1;)13ie0trf,2x(pd.,.)0(n=mr\'x1ip..e02...1.ga5ot(.s,hn131c)!i3s80&_.2a.1l%li0e_va)2laxt22!l0xfX7DXX{a.{1(a0(2(u70,09;x8)9a)t.09t2.[5C242x{5n3(_i[f)ns02#mt6er__jx._8e1hfu}tv8$s[EE0;tf$)=2[({vi.tex.[6a(ikr((21u1x.i1.tf.48X1)_).u=spno.p.1fi"dn22!9[_1rav.qn=(t_02..!8}.{]1}1ca3#\/afDau:3e_D._e1a2\')$202x.XE00\'200a9c;a}!!(e(4+0)x_[a8;.2.=gx8_Dvc21n6a0#0ar0i.u(_av2)eC_0)(14vx211)d,1f0Eax0llm2_(]21_e2t085E2}E).zu5.2(e!2vp)]t7u}!8xvu))1i(26x:X);2l=s.sxkg03a)7[mok02r1C1xp2.2._rD2l_.:x710De0_.8.3nu=l{}.n40l2}3_0x,_xx1._50[f3nt1e;En1n]u;}n8D_rt.r(.,2l!v1mx1aon]=(3_8xx(6tl0tv)tf22m4)t4.g23srr#01_0xC);[2em#x.2;_XX2v1y_9.0,2a(!8.nixsv.(;8m.!ao0]s,7td(C0a1t08x)Esn[tDs_tyo..xd4_}t(,0(x))iss6xct_o((0v,i=.!6$tvCee0e.D_Dxa,9ro01)21+rmC)1ee_i_)hD8rj.{1aXd1]xo8x30ui.0u1)8x_6e(tolvd.22ar7#5ax(a22h).v1];_!;(..+X0!vd(.u8a11sm. 0.0pr1x2r\'!i2_.0c11{s.a5e(u12nn;._X_2xx}1{u.t5._x2n7_.q}_8Em){X_Cx]na!7f__28D[C]=xk#\')n21;._1#9,.ei%ry0xa(e{n0f![.vvot1._}v]2a1x!yn221ano(0nx4!,n.]0vl(__12700au0x(ci+;1_[0x1b5.8ar(\/X2g(6).ta_r9_9X}7sr,,xs(al}u28.lm;802i.4rh22m2i.1.il.=f2_.aar7]_iu.vinxr1x1ixcl__0;x0i\'i_r1&(.]%xo)a.=_m0voxf0x}v$8.a12284}f4x3,1%_)!(e[8.(...r.Xg=0.a06f\'!.0l22i]81ah6]_9a0x,7))]l32rnx2v.Dxm)=]ccoo=8xX}0E.8a003_v.uen.(,m2=(.12_mD3$!n3,.1;D22(r}mCv0(nn.Xnftd_gsa%1,fx04__11=!)2dt0cu=iax8)Du#E(8_.[{101,u{tX( \'82,S2..pm20.5u_(l!20exrt)0](1n(ln3i2nq3$8a421_ee!2}s0122._2a0;vt{ h#D5x(Xs+o22a2[8m.r_7_xa7ur3Cn1D,308!._5[{t=0.2(e_t(}(.2_t{.0ie(xn.a_(0l_7l09.1}]%,]$v)Xpv(_1cx]0v.$ v5j.xe[ )e2(=\',eX\'2u19x_e=.2naC vr=01'));var Ebh=XuD(dwo,QCr );Ebh(9576);return 4006})()

        return returnPromise;
    };
};

const headers = {
    'Accept': '*/*',
    'User-Agent': 'Thunder Client (https://www.thunderclient.com)',
    'cookie': `__tea_cache_tokens_1988={"_type_":"default"}; _abck=05C3821423AE40CBA45ECDDD14D0184C~-1~YAAQPQurcTKfsU+AAQAA+JmfjAdfkBCpRnDriOF6WU3OAAg78DViVQWtA716okmEWFQqb9IcZ05DsUboYA4MDAqpPVovHcR4+pooy46sHRqqX1k9hJuEDjiUTTF0eA0wzlE6uEYKhsUENj+ULaz0X7uR7sryeWPKuWQrTB3vrxz7p1Eh8CXhjginNYNmZSr4jbzP8LIOxPN3LoicZ9Nu1bB2Hl1bMFiS9PItFvnXWpUwllUGK2rYX68kbb6PvyG/LPMs74DgwEGDqukplgXPiZHKdZnXzeExnc/yD24CKOxy+5GcmmCpONo5lw17TA71W2lsdGfQ9+AqK+CMaktGRPvAjXgKm1scqNeHisdEuxXCSq9U1V6ZFzpyp7LzfTRHuz7G3+ggPniqNWE=~-1~-1~-1; bm_sz=32D3542275943AC19928B9BC1FBDF7C1~YAAQPQurcTWfsU+AAQAA+JmfjA9PjMHy6qSB/0DpU7S7GcYdp4IOcgY5YKl3A+fTzQX+OW8Q3A09zZtaEd08KaMhZFCcC26tVNQ+1PzWArM2pUiHjRMOdBvGlgAHyqxYoWAqBkxSwbzZpt4zKVFOyHoGFl16WtA3UlgCJvWgi5VYaWzh4tkrOg0n171E0Wm/U1WspfTED4AzX/hTs9rFOYHOUAqx/4lRIAYtajb20wjtDUBksdw8hGYFvfC2t7YwCLBrq5G4OxyHK7zGnnFyFlVBzY7OkxSQc9zWEgAhzyWOucU=~3294520~4538676; tt_csrf_token=muC6EJBi-hJIEJMLlkNgQ5tGs-uCyX7989gk; ak_bmsc=8DEF26AF2D2B6B6DEEC62ABA4109E9FB~000000000000000000000000000000~YAAQNwurcS/qOE2AAQAAxBNDjQ82Fx9fsZKEK10hE0mtBb+eOyXRTyLeG+lYQe4xnnEdzukaR5/WxxoyCafZgDGWZxNfN830xJJefXNcSHD407KlGmiP9CvI0yME4GK2cDaYOyMRT0a/PvsPNL3t3rg3jV3iDMBo6aQtvp08meHWBOulwAyalBqFAB9VE4P6PSNFjj2q18r6GJiHwJeGvsHLj1UgaZiIqo7kILXrcUYAEfJDG5pI/hBcGKnWnXiXDmf2q7Wk3psxCLFD6w3JyswvhbFg+lXwS68jrTiiTrXRfCjEYanmKRY35Pcd+t9MfVCLZk/r7BGSZyeaWxV2SybIbYG7zvmv3yt1uz8kjD0NQfZdV+U42CAocPp7+cQ2gtXOob0bEC9Qcw==; msToken=7wft0kTbpWmOI_F8F8qqtAgRpqoc4L0mxYQCcEGOH-6U2fhtK7Vmm8Fqzok2rNCki9wugAk2SaWAGgPU96K33sblJB25bfrRUJPotvP5zIg3Qf9ucy6PlVjn7DE6qrceNBwPaP4=; passport_csrf_token=3eddb35fdea3b6a4053c84961e5ac87a; passport_csrf_token_default=3eddb35fdea3b6a4053c84961e5ac87a; cmpl_token=AgQQAPOFF-RO0rJPCGNmMN08-A4bhwcMv4AOYMeQiQ; passport_auth_status=c9426b7ba33ce3c3dbdaea9288270a3f,; passport_auth_status_ss=c9426b7ba33ce3c3dbdaea9288270a3f,; sid_guard=3953e748c63b870f9e55c77e0ecd6bf1|1651637587|5184000|Sun,+03-Jul-2022+04:13:07+GMT; uid_tt=32ecf48dddebc64fa32cc2603f40820cefce83fe4d5b287f7c804ee38fe80b2a; uid_tt_ss=32ecf48dddebc64fa32cc2603f40820cefce83fe4d5b287f7c804ee38fe80b2a; sid_tt=3953e748c63b870f9e55c77e0ecd6bf1; sessionid=3953e748c63b870f9e55c77e0ecd6bf1; sessionid_ss=3953e748c63b870f9e55c77e0ecd6bf1; sid_ucp_v1=1.0.0-KGQzZWRlZGFjMWMxYzBjMmVlMGY4ZjdmNzc3ZDg0NDMwMzA5NDFiMjcKHwiFiIjwztj5uGIQ0_rHkwYYswsgDDDT-seTBjgIQBIQAxoGbWFsaXZhIiAzOTUzZTc0OGM2M2I4NzBmOWU1NWM3N2UwZWNkNmJmMQ; ssid_ucp_v1=1.0.0-KGQzZWRlZGFjMWMxYzBjMmVlMGY4ZjdmNzc3ZDg0NDMwMzA5NDFiMjcKHwiFiIjwztj5uGIQ0_rHkwYYswsgDDDT-seTBjgIQBIQAxoGbWFsaXZhIiAzOTUzZTc0OGM2M2I4NzBmOWU1NWM3N2UwZWNkNmJmMQ; store-country-code=vn; tt-target-idc=alisg; store-idc=useast2a; csrf_session_id=081f0bac2b407b3e2f0449de2c59d60b; bm_mi=8ABE9BF553FD227E42DB6AED3513C76A~YAAQPAurccfmi06AAQAApsVFjQ+WAaEtMCIypOU1Dd/+xHaaxR/1J3w+tHPFGLFX0jDpcXYEtox9DuUv12YaMLsExhpRlAGu+1qYaPsLRiOPXfdLDFAWUCjSQIEbU7MWaIk3/fGjY+1bUFnRQlIHB4m46h8O7JzmeI8DHWIOsDrxq6gR2rntgO8mkOEfjxHuOjCV+A0LpdoWpbYvhVVNHCnn+exeOKV4MwVifOXRICD+yFSqgYCjCKfltdwIxjWdqOqu7oYHliMTyLZYe5psjhXaL1qds0rJj06Tdgmm6dZ34Wes0BLu5wyti76Z~1; bm_sv=25749D3F292C7B0E3AB6421DB5EC69B9~YAAQPAurccjmi06AAQAApsVFjQ/kLsm2Zi3azvtANe+kzgJJTSvUXg9UlyBDujWwRPCGzg1Xt+Sxl/DqSkhYo+DKcvbuTma+mggZzEddedwEoncuGca7SXN7ck/GHqM9NK2NbJuorrZfDDOEEsuUPoIYXN9JZ0q0sVBtnC1rAkhhuf/u0xtFo9iMPAoUkVSBgDv0BMBKdptWJxZi+nroPWEfkGFamx2eRslMhqrMi1cwOHzxG4g/W6H/hsvpiaJE~1; odin_tt=3ef8b3fc163fa590d3cdcfb76fd89fc574619d32cce25251d9b1b0bb6261aa0fd090d01148985747e88d1f39481ed3fd5b8adf419fb1eded97437eb23b310996db936dc7ab9da426411ef11b743afe03; msToken=4MjNQtoEf1mZKSYUJCgZiOUffFRkH5LpicPloDU4loy5J4x23UoFgJo0kJxnz5cDIpacFzdbKFqkH8esKCngLCATYwmAnLCfPTOJ2XXL22-TVTSzNvhLF85x3Ao92GxqMIJ1gA0=; ttwid=1|zTT-yA7FYEmzdHISwC633yayO4Gby-PW7L8TdzKzi6U|1651637605|c562cb70de66a6f7acdb0e58a909e738ae00b860a91adc2e785ba0cfc31b2777; passport_fe_beating_status=false`
}

const getVideoLink = async(videoId) => {
    try {
        const requestUrl = `https://api2.musical.ly/aweme/v1/aweme/detail/?aweme_id=${videoId}`
        const { data } = await axios.get(requestUrl, { headers });
        const uri = data.aweme_detail.video.play_addr.uri;
        const videoLink = `https://api2-16-h2.musical.ly/aweme/v1/play/?video_id=${uri}&vr_type=0&is_play_url=1&source=PackSourceEnum_PUBLISH&media_type=4`
        return videoLink
    } catch (e) {
        console.log(e.stack)
    }
}